class BloodWeapon : Weapon
{
	double zVel;
	double zCamera;
	double zWeapon;
	int timer;
	const zVelSmooth = 0.3;
	const zWeaponScale = 1.0;
	const zWeaponSmooth1 = 0.95;
	const zWeaponSmooth2 = 0.4;
	const zWeaponViewScale = 0.017;
	action void A_AnimateZBobSetup()
	{
		invoker.timer = 0;
		invoker.zVel = 0.0;
		invoker.zWeapon = player.viewZ;
		invoker.zCamera = player.viewZ;
	}
	action void A_AnimateZBob(int flags = 0)
	{
		A_WeaponReady(flags);
		let psp = player.GetPSprite(PSP_WEAPON);
		double zVel = (player.viewZ-invoker.zCamera)*35.0;
		invoker.zCamera = player.viewZ;
		invoker.zVel = invoker.zVel*(1.0-invoker.zVelSmooth)+zVel*invoker.zVelSmooth;
		double zDelta = player.viewZ-invoker.zWeapon;
		if (zDelta > 0)
			zVel += zDelta*zWeaponSmooth2/zWeaponScale;
		else
			zVel += zDelta*zWeaponSmooth1/zWeaponScale;
		invoker.zWeapon += zVel*zWeaponScale;
		psp.y += max(-15,(invoker.zWeapon-player.viewZ)*zWeaponViewScale);
		//A_Log(""..zVel);
		// invoker.timer++;
	}
}