actor MagnumLoadedToken : Inventory {
	Inventory.MaxAmount 1
	+UNDROPPABLE
}

actor MagnumToken : Inventory {
	Inventory.MaxAmount 6
	+UNDROPPABLE
}

ACTOR Magnum : Postal3dWeapon
{
Weapon.AmmoUse1 0
	Weapon.AmmoGive1 6
	Weapon.AmmoUse2 0
	Weapon.AmmoGive2 0
	Weapon.AmmoType1 "MagnumLoad"
	Weapon.AmmoType2 "Magazine3"
Scale 0.7
Inventory.PickupMessage "\c[red]You got the \c[Purple]Magnum Revolver"
  Inventory.PickupSound "MCLOS"
  +weapon.NoAutoaim
  +Weapon.NoAutoFire
  
  States
  { 
	Ready:
	TNT1 A 0 A_JumpIfInventory("Kicking",1,"Kick")
	TNT1 A 0 A_JumpIfInventory("ExecuteDownedEnemy", 1, "DoExecution")
	TNT1 A 0 A_JumpIfInventory("MagnumLoadedToken", 1, "ReadyLoaded")
	MAGR A 1 A_WeaponReady(WRF_ALLOWRELOAD|WRF_ALLOWZOOM)
	loop

	ReadyLoaded:
	TNT1 A 0 A_JumpIfInventory("Kicking",1,"Kick")
	TNT1 A 0 A_JumpIfInventory("ExecuteDownedEnemy", 1, "DoExecution")
	MAGR Q 1 A_WeaponReady(WRF_ALLOWRELOAD|WRF_ALLOWZOOM)
	loop
	
	AltFire:
	TNT1 A 0 A_JumpIfInventory("MagnumLoadedToken", 1, "AltFireUnload")
	MAGR GH 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
	MAGR J 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
 	TNT1 A 0 A_PlaySound ("MHAM1",CHAN_AUTO)
	MAGR KL 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
	TNT1 A 0 A_PlaySound ("MHAM2",CHAN_AUTO)
	MAGR M 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
	MAGR NOP 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
	TNT1 A 0 A_GiveInventory("MagnumLoadedToken",1)
	Goto Ready

	AltFireUnload:
	MAGR PON 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
	MAGR M 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
 	TNT1 A 0 A_PlaySound ("MHAM2",CHAN_AUTO)
	MAGR LK 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
	TNT1 A 0 A_PlaySound ("MHAM1",CHAN_AUTO)
	MAGR J 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
	MAGR HG 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOPRIMARY)
	TNT1 A 0 A_TakeInventory("MagnumLoadedToken",1)
	Goto Ready
	
	Select:
		TNT1 A 1
		TNT1 AAAAAAAAAAAAAAA 0 A_Raise
		TNT1 A 1 Offset(119, 99)
		TNT1 A 0 A_PlaySound ("WEPSEL",CHAN_AUTO)
		TNT1 A 0 A_Jump(226, 2)
		TNT1 A 0 A_PlaySound("Dude/MG/Select", CHAN_VOICE)
		MAGR A 1 Offset(119, 99)
		MAGR A 1 Offset(76, 65)
		MAGR A 1 Offset(46, 53)
		MAGR A 1 Offset(21, 39)
		MAGR A 1 Offset(5, 35)
		Goto Ready
	Deselect:
		MAGR A 1 Offset(5, 35)
		MAGR A 1 Offset(21, 39)
		MAGR A 1 Offset(46, 53)
		MAGR A 1 Offset(76, 65)
		MAGR A 1 Offset(119, 99)
		TNT1 A 5
		TNT1 AAAAAAAAAAAAAAA 0 A_Lower
		Wait
	KickFlash:
		MAGR A 16
		Stop
	Spawn:
	REVP A 1
	loop

Reload:
TNT1 A 0 A_JumpIfInventory ("Magazine3",6,"Ready")
Goto Reloading

	Fire:
	TNT1 A 0 A_JumpIfInventory("MagnumLoadedToken", 1, "Fire4")
 	TNT1 A 0 A_PlaySound ("MHAM1",CHAN_AUTO)//
	MAGR A 1
	MAGR A 1 A_refire ("Fire2")
	Goto Ready
	Fire2:
	MAGR B 1 //A_WeaponOffset(Random(-0.7,0.7), Random(35, 40), WOF_Interpolate)
	MAGR B 1 A_Refire ("Fire3")
	MAGR A 1
	Goto Ready
	Fire3:
	TNT1 A 0 A_PlaySound ("MHAM2",CHAN_AUTO)
	MAGR CD 1 //A_WeaponOffset(Random(-0.7,0.7), Random(35, 40), WOF_Interpolate)
	MAGR E 1 
	MAGR E 1 A_Refire ("Fire4")
	MAGR EDC 1 
	MAGR B 1 //A_WeaponOffset(Random(-0.7,0.7), Random(35, 40), WOF_Interpolate)
	MAGR A 1 //A_WeaponOffset(Random(-0.7,0.7), Random(35, 40), WOF_Interpolate)
	Goto Ready
	Fire4:
	MAGR A 0
	TNT1 A 0 A_JumpIfInventory ("Magazine3",1,"Firestart")
	goto OutOfAmmo
	FireStart:
	TNT1 A 0 A_Takeinventory("DoubleMagazine3",1)
		TNT1 A 0 A_PlaySound("MFIR",CHAN_AUTO)
		TNT1 A 0 A_FireCustomMissile("P3D_MagnumTracer",0,0,7,3)
	TNT1 A 0 A_Jump (256,"MF1","MF2")
	Goto Ready
	MF1:
	TNT1 A 0 A_WeaponOffset(Random(-2, 2), Random(35, 40), WOF_Interpolate)
	MAGM A 1 BRIGHT
	MAGM C 1 BRIGHT
	Goto FireFinish
	
	MF2:
	TNT1 A 0 A_WeaponOffset(Random(-2, 2), Random(35, 40), WOF_Interpolate)
	MAGM B 1 BRIGHT
	MAGM C 1 BRIGHT
	Goto FireFinish
	
	FireFinish:
	TNT1 A 0 A_GiveInventory ("MagnumToken",1)
	    TNT1 A 0 A_TakeInventory ("Magazine3",1)
	TNT1 A 0 A_JumpIfInventory("MagnumLoadedToken", 1, 3)
	    TNT1 A 0 A_Recoil (4)
		TNT1 A 0 A_setpitch(pitch-3)
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_FireCustomMissile("ShakeYourAssDouble", 0, 0, 0, 0)
		TNT1 AAAAAAA 0 A_FireProjectile("SmokeSpawner",0,0,7,3)
		MAGF ABC 3
		MAGF DEF 2
		TNT1 A 0 A_TakeInventory("MagnumLoadedToken",1)
		goto Ready

	
OutOfAmmo:
TNT1 A 0 A_PlaySound ("AKEMPT",CHAN_AUTO)
TNT1 A 0 A_Print ("\c[yellow]Out of ammo",1)
Goto Ready

Reloading:
//NEW RELOAD - 55.5 TICS CACLUATED NEEDED
TNT1 A 0 A_JumpIfInventory ("Magazine3",6,"FinishReload")
TNT1 A 0 A_JumpIfInventory ("MagnumLoad",1,"StartReload")
goto FinishReload

StartReload:
MAGL A 3 A_PlaySound ("AKMOV",CHAN_AUTO)
MAGL B 3
TNT1 A 0 A_PlaySound ("MOPN",CHAN_AUTO)
MAGL CDEFGHI 3
TNT1 A 0 A_PlaySound ("MOPN",CHAN_AUTO)
TNT1 A 0 A_JumpIfInventory("Magazine3",5,"1BulletOut")
TNT1 A 0 A_JumpIfInventory("Magazine3",4,"2BulletOut")
TNT1 A 0 A_JumpIfInventory("Magazine3",3,"3BulletOut")
TNT1 A 0 A_JumpIfInventory("Magazine3",2,"4BulletOut")
TNT1 A 0 A_JumpIfInventory("Magazine3",1,"5BulletOut")
6BulletOut:
//TNT1 A 0 A_FireCustomMissile ("MagnumCasing",random(0,360),0,random(15,-15))
TNT1 A 0 A_FireCustomMissile ("MagnumCasingSpawner",0,0,-10,-5)
5BulletOut:
//TNT1 A 0 A_FireCustomMissile ("MagnumCasing",random(0,360),0,random(15,-15))
TNT1 A 0 A_FireCustomMissile ("MagnumCasingSpawner",0,0,-10,-5)
4BulletOut:
//TNT1 A 0 A_FireCustomMissile ("MagnumCasing",random(0,360),0,random(15,-15))
TNT1 A 0 A_FireCustomMissile ("MagnumCasingSpawner",0,0,-10,-5)
3BulletOut:
//TNT1 A 0 A_FireCustomMissile ("MagnumCasing",random(0,360),0,random(15,-15))
TNT1 A 0 A_FireCustomMissile ("MagnumCasingSpawner",0,0,-10,-5)
2BulletOut:
//TNT1 A 0 A_FireCustomMissile ("MagnumCasing",random(0,360),0,random(15,-15))
TNT1 A 0 A_FireCustomMissile ("MagnumCasingSpawner",0,0,-10,-5)
1BulletOut:
//TNT1 A 0 A_FireCustomMissile ("MagnumCasing",random(0,360),0,random(15,-15))
TNT1 A 0 A_FireCustomMissile ("MagnumCasingSpawner",0,0,-10,-5)
ShitIsOut:
	MAGL JKLMNO 3
	//45 total
	Goto Bulletin3

Bulletin3:
TNT1 AAAA 0
TNT1 A 0 A_JumpIfInventory ("MagnumToken",6,"FullStartReload")
		TNT1 A 0 A_JumpIfInventory("Magazine3",6,"ReloadContinue2")
		TNT1 A 0 A_JumpIfInventory("MagnumLoad",1,"Bulletin4")
	   goto FinishReload
		Bulletin4:
        TNT1 AAAAAA 0
		TNT1 A 0 A_PlaySound ("MINSERT",CHAN_AUTO)
		MAGL PQRSTUVW 3
		
		//TNT1 A 0 A_FireCustomMissile ("MagnumCasingSpawner",0,0,-10,-5)
		TNT1 A 0 A_Giveinventory("Magazine3",1)
		TNT1 A 0 A_Giveinventory("DoubleMagazine3",1)
		TNT1 A 0 A_Takeinventory("MagnumLoad",1)
		Goto Bulletin3


ReloadContinue2:
MAGL XYED 3
TNT1 A 0 A_PlaySound ("MCLOS",CHAN_AUTO)
MAGL CBA 3
goto FinishReload

FullStartReload:
MGL2 A 3 A_PlaySound ("AKMOV",CHAN_AUTO)
MGL2 BC 3
TNT1 A 0 A_PlaySound ("MINSSPL",CHAN_AUTO)
MGL2 DEF 3
MGL2 G 3 
TNT1 A 0 A_PlaySound ("MOPN",CHAN_AUTO)
MGL2 H 3
MAGL B 3
TNT1 A 0 A_playSound ("MFLY",CHAN_AUTO)
MAGL A 3
//66 total
goto Bulletin

ReloadContinue:
/*TNT1 AAAA 3
TNT1 A 0 A_PlaySound ("MINSSPL",CHAN_AUTO)
TNT1 AAA 3
MAGU ABCDE 3
MAGL I 2
MAGL H 2 A_PlaySound ("MCLOS",CHAN_AUTO)
MAGL GFEDCBA 2*/
goto FinishReload

Bulletin:
TNT1 AAAA 0
		TNT1 A 0 A_JumpIfInventory("Magazine3",6,"ReloadContinue")
		TNT1 A 0 A_JumpIfInventory("MagnumLoad",1,"Bulletin2")
	   goto FinishReload
		Bulletin2:
        TNT1 AAAAAA 0
		TNT1 A 0 A_Giveinventory("Magazine3",1)
		TNT1 A 0 A_Giveinventory("DoubleMagazine3",1)
		TNT1 A 0 A_Takeinventory("MagnumLoad",1)
		Goto Bulletin
		
		FinishReload:
		TNT1 A 0 A_Takeinventory ("MagnumToken",6)
		MAGR A 1
		Goto Ready

  }
}

ACTOR Magazine3 : Ammo
{
   Inventory.Amount 0
   Inventory.MaxAmount 6
   Ammo.BackpackAmount 0
   Ammo.BackpackMaxAmount 6
   scale 0.2
   Inventory.Icon "REVPA0"
}

ACTOR DoubleMagazine3 : Ammo
{
   Inventory.Amount 0
   Inventory.MaxAmount 12
   Ammo.BackpackAmount 0
   Ammo.BackpackMaxAmount 12
   Inventory.Icon "REVPA0"
}